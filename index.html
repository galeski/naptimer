<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Page Title</title>
  <style>
    :root {
      --background-color: #ffffff;
      --text-color: #333333;
      --link-color: #0000ff;
      --header-background: #f0f0f0;
      --border-color: #cccccc;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --background-color: #1a1a1a;
        --text-color: #f0f0f0;
        --link-color: #6699ff;
        --header-background: #333333;
        --border-color: #444444;
      }
    }

    body {
      background-color: var(--background-color);
      color: var(--text-color);
    }

    a {
      color: var(--link-color);
    }

    header {
      background-color: var(--header-background);
    }

    .border {
      border-color: var(--border-color);
    }

    /* CSS */
    .button-40 {
      background-color: #111827;
      border: 1px solid transparent;
      border-radius: .75rem;
      box-sizing: border-box;
      color: #FFFFFF;
      cursor: pointer;
      flex: 0 0 auto;
      font-size: 1.125rem;
      font-weight: 600;
      line-height: 1.5rem;
      padding: .75rem 1.2rem;
      text-align: center;
      text-decoration: none #6B7280 solid;
      text-decoration-thickness: auto;
      transition-duration: .2s;
      transition-property: background-color, border-color, color, fill, stroke;
      transition-timing-function: cubic-bezier(.4, 0, 0.2, 1);
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      width: auto;
    }

    .button-40:hover {
      background-color: #374151;
    }

    .button-40:focus {
      box-shadow: none;
      outline: 2px solid transparent;
      outline-offset: 2px;
    }

    @media (min-width: 768px) {
      .button-40 {
        padding: .75rem 1.5rem;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>NAPTIMER</h1>
  </header>

  <nav>
    <!-- Add your navigation menu items here -->
  </nav>

  <main>
    <h2>Select length of nap (minutes)</h2>

    <button class="button-40" onclick="myFunc(this)">5</button>
    <button class="button-40" onclick="myFunc(this)">10</button>
    <button class="button-40" onclick="myFunc(this)">15</button>
    <button class="button-40" onclick="myFunc(this)">25</button>
    <button class="button-40" onclick="myFunc(this)">30</button>
    <button class="button-40" onclick="myFunc(this)">45</button>
    <button class="button-40" onclick="myFunc(this)">60</button>

    <hr>
    <button class="stop" onclick="myFunc2(this)">STOP</button>

    <h2 id="current-time">.</h2>
  </main>

  <footer>
    <p>&copy; 2024 Your Name. All rights reserved.</p>
  </footer>

  <script src="
      https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.min.js
    "></script>

  <script>
    const TimerModule = (function () {
      let instance = null;

      class Timer {
        constructor(sleepTime) {
          if (Timer._instance) {
            console.log("only single instance allowed");
            return;
          }
          // timer._instance = this;

          this.sleepTime = sleepTime;
          this.startTime = new Date();
          this.isRunning = false;
          this.timeLeft = this.sleepTime;
        }

        updateTime() {
          if (this.isRunning) {
            const currentTime = new Date();
            const elapsedTime = (currentTime - this.startTime) / 1000; // to sec
            this.timeLeft = Math.ceil(Math.max(0, this.sleepTime - elapsedTime));
          }
        }

        start() {
          if (!this.isRunning) {
            this.isRunning = true;
            this.startTime = new Date();
          }
        }

        stop() {
          if (this.isRunning) {
            this.updateTime();
            this.isRunning = false;
          }
        }

        reset(newSleepTime) {
          this.stop();
          this.sleepTime = newSleepTime || this.sleepTime;
          this.timeLeft = this.sleepTime;
          this.startTime = new Date();
        }
      }

      return {
        getInstance: function (sleepTime) {
          if (!instance) {
            instance = new Timer(sleepTime);
          }
          return instance;
        }
      };
    })();

    // TODO: Is the name createTimer descriptive enough?
    function createTimer(sleepTime) {
      const timer = TimerModule.getInstance(sleepTime);

      if (sleepTime !== undefined && sleepTime !== timer.sleepTime) {
        timer.reset(sleepTime);
      }

      return timer;
    }

    function myFunc(arg) {
      const sleepTime = Number(arg.textContent) * 60;
      const currentTime = document.getElementById("current-time");
      const timer = createTimer(sleepTime);

      timer.start();

      setInterval(() => {
        timer.updateTime();
        currentTime.innerHTML = timer.timeLeft;

        console.log("running")

        // Check if the timer has finished
        if (timer.timeLeft <= 0) {
          timer.stop();

          // LOGIC TO SOUND THE ALARM
          createAlarm();

          console.log("Timer finished!");
        }
      }, 1000);
    }

    function myFunc2() {

    }

    // courtesy of gpt
    function handleColorSchemeChange() {
      const colorScheme = window.matchMedia('(prefers-color-scheme: dark)');

      function updateColorScheme(e) {
        if (e.matches) {
          document.body.classList.remove('light-mode');
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.remove('dark-mode');
          document.body.classList.add('light-mode');
        }
      }

      // Initial call
      updateColorScheme(colorScheme);

      // Listen for changes
      colorScheme.addListener(updateColorScheme);
    }

    // Call the function when the page loads
    document.addEventListener('DOMContentLoaded', handleColorSchemeChange);

    function createAlarm(stopPlaying = false) {
      if (!stopPlaying) {
        let sound = new Howl({
          src: ['https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3'],
          volume: 0.5,
          onend: function () {
            console.log('Loop finished');
          }
        });

        sound.play();
      } else return "stopped playing";
    }
  </script>
</body>

</html>